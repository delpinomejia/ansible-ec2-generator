stages:
  - validate
  - build
  - deploy

validate_all:
  stage: validate
  script:
    - ansible --version
    - pip3 install boto3 botocore
    - ansible-galaxy collection install amazon.aws community.general --force
    - ansible-playbook --syntax-check ec2-playbook.yml
    - echo "Validation completed"
  tags:
    - homelab
    - local

build_configuration:
  stage: build
  script:
    - echo "Build stage"
    - ls -la vars/
    - cp vars/vars_sample.yml vars/vars.yml
    - echo "Configuration prepared"
  artifacts:
    paths:
      - vars/vars.yml
    expire_in: 1 hour
  tags:
    - homelab
    - local

deploy_to_aws:
  stage: deploy
  script:
    - echo "Deploy stage"
    - ansible-playbook ec2-playbook.yml
  tags:
    - homelab
    - local
